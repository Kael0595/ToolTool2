<!DOCTYPE html>
<html xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <link rel="stylesheet" href="/article_detail.css"/>
    <link rel="stylesheet" href="/layout/navbar_no.css"/>
    <link rel="stylesheet" href="/layout/footer.css"/>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://kit.fontawesome.com/af580f77b6.js" crossorigin="anonymous"></script>
    <title>툴툴</title>
</head>

<body>
<!-- 네비바 시작 -->
<div class="top__bar">
    <nav class="top__bar_menu">
        <div class="logo_box">
            <ul>
                <li>
                    <a href="http://localhost:8080/">
                        <button type="button" class="logo_button">
                            <img src="/img/230605_툴툴_로고 복사 1.png"/>
                        </button>
                    </a>
                </li>
            </ul>
        </div>
        <div class="main_menu">
            <ul class="main_menu_ul">
                <li>
                    <a href="http://localhost:8080/article/list">
                        <span>Review</span>
                    </a>
                </li>
                <li>
                    <a href="http://localhost:8080/market/list">
                        <span>Market</span>
                    </a>
                </li>
                <li>
                    <a href="http://localhost:8080/Notice/list">
                        <span>Notice</span>
                    </a>
                </li>
            </ul>
        </div>
        <div class="signLine">
            <div class="signIn" sec:authorize="isAuthenticated()" th:href="@{/user/logout}">
                <a href="http://localhost:8080/user/logout">
                    <button type="button" class="signIn_button">
                        <i class="fa-solid fa-right-to-bracket fa-2xl" style="color: #73703f;"></i>
                    </button>
                </a>
            </div>

            <div class="signIn" sec:authorize="isAnonymous()" th:href="@{/user/login}">
                <a href="http://localhost:8080/user/login">
                    <button type="button" class="signIn_button">
                        <img src="https://i.postimg.cc/dQGcFnFG/login.png" class="signIn_img"/>
                    </button>
                </a>
            </div>

            <div class="signUp" sec:authorize="isAuthenticated()" th:href="@{/user/logout}">
                <a href="http://localhost:8080/mypage">
                    <button type="button" class="signUp_button">
                        <img src="https://i.postimg.cc/wMXCkx2w/mypage.png" class="signUp_img"/>
                    </button>
                </a>
            </div>
            <div class="signUp" sec:authorize="isAnonymous()" th:href="@{/user/login}">
                <a href="user/signup_menual">
                    <button type="button" class="signUp_button">
                        <img src="https://i.postimg.cc/vHzRgBcB/signup.png" class="signUp_img"/>
                    </button>
                </a>
            </div>
        </div>
    </nav>
</div>
<!-- 네비바 끝 -->

<!-- 리뷰 박스 시작 -->
<div class="Review_form">
    <div class="Article_content_Box">

        <div class="article_header">
            <div class="articlenum">
                <span>no.</span>
                <span th:text="${article.id}" class="articleNum">123</span>
            </div>
            <div class="modifyRemove">
                <a th:href="@{|/article/modify/${article.id}|}"
                   sec:authorize="isAuthenticated()"
                   th:if="${article.author != null and #authentication.getPrincipal().getUsername() == article.author.username}"
                >
                    <button class="modify">수정</button>
                </a>
                <a href="javascript:void(0);" th:data-uri="@{|/article/delete/${article.id}|}"
                   sec:authorize="isAuthenticated()" class="delete btn btn-sm btn-outline-secondary"
                   th:if="${article.author != null and #authentication.getPrincipal().getUsername() == article.author.username}"
                >
                    <button class="remove">삭제</button>
                </a>
            </div>

            <div class="article_title">
                <p th:text="${article.subject}" class="article_title">헬리녹스 의자리뷰</p>
            </div>
            <hr>
            <div class="userInfoform">
                <div class="userInfo">
                    <div class="userPhoto"></div>
                    <div class="profile_area">
                        <div class="profile_info">
                            <span th:if="${article.author != null}" th:text="${article.author.nickname}"
                                  class="nick"></span>

                        </div>
                    </div>
                    <div class="article_info">
                        <div class="createtime">
                            <span class="create">작성시간</span>
                            <span th:text="${article.createDate}" class="create_time"></span>
                        </div>
                        <div class="viewcount">
                            <span class="count">조회수 </span>
                            <span th:text="${article.viewCount}" class="count"></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="gradeOrhashtag">
            <div class="grade">
                <span class="user_grade">사용자 총 평점</span>
                <strong th:text="${article.starScore}" class="user_grade_point"></strong>
            </div>
            <br>
            <div class="grade">
                <span class="user_grade">구입가격</span>
                <strong th:text="${article.Price}" class="user_grade_point"></strong>
                <span>원</span>
            </div>

            <div class="hashtag">
                <a class="hashtaglink" href="#">
                    <button th:text="${article.type}" type="button" class="category1"></button>
                </a>
                <a class="hashtaglink" href="#">
                    <button th:text="${article.season}" type="button" class="category1"></button>
                </a>
            </div>

        </div>
        <div class="article_container">
            <div class="SaleInfo">
                <div class="product_section">
                    <div class="product_img" th:each="filepath : ${article.filepaths}">
                        <img th:src="${filepath}" width="500" height="500" class="review_board_main_img"/>
                    </div>
                    <div class=""></div>
                </div>
            </div>
            <div class="content_form">
                <div class="content_view">
                    <p th:text="${article.content}" class="content_write"></p>
                    <div class="icon_box">
                        <div class="iconLine">
                            <div class="like">
                                <a href="#" role="button" class="like_heart">
                                    <i class="fa-regular fa-heart"></i>
                                </a>

                                <em class="u_ico _icon"></em>
                                <span class="u_txt _label">좋아요</span>
                                <strong th:text="${#lists.size(article.voter)}" class="u_cnt _count"></strong>


                                <i class="fa-regular fa-message" style="color: #73703f;"></i>
                                <a href="#" role="button" aria-pressed="true" class="button_comment"><span
                                        class="icon_area"></span>
                                    댓글<strong th:text="|${#lists.size(article.answerList)}" class="num"></strong>
                                </a>
                            </div>

                            <div class="replyBox">
                                <div th:each="answer : ${article.answerList}" class="answerbox">
                                    <!-- 댓글 닉네임   -->
                                    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
                                    <div class="answerNick">
                                        <span th:if="${answer.author != null}" th:text="${answer.author.nickname}"
                                              class="nick">닉네임</span>
                                    </div>
                                    <!-- 댓글 닉네임 끝 -->
                                    <!-- 댓글내용 -->
                                    <div class="answer">
                                        <ul>
                                            <li th:text="${answer.content}"></li>
                                        </ul>
                                    </div>
                                    <!--  댓글내용 끝  -->
                                    <!--수정-->
                                    <div class="formmodifybox">
                                        <form th:action="@{|/answer/modify/${answer.id}|}" th:object="${answerForm}"
                                              method="post" class="formboxform">

                                        <textarea name="content" id="content" rows="10"
                                                  placeholder="수정할 내용을 작성해주세요"></textarea>
                                            <button class="reply_summit" type="submit" value="답변수정">답변수정</button>
                                            <button class="reply_summit_exit" type="button" value="취소"
                                                    onclick="hideFormModifyBox(event, this)">수정취소
                                            </button>

                                        </form>

                                    </div>
                                    <!--수정 끝-->
                                    <!-- 댓글 하단바   -->
                                    <div class="answerCreateBox">
                                        <div class="answerCreateDate">
                                            <span>작성일:</span>
                                            <span th:text="${answer.createDate}"></span>
                                            <!--  수정/삭제버튼 -->
                                        </div>
                                        <div class="answerModifyRemove">
                                            <a href="#" sec:authorize="isAuthenticated()"
                                               class="modify btn btn-sm btn-outline-secondary"
                                               th:if="${answer.author != null and #authentication.getPrincipal().getUsername() == answer.author.username}"
                                               th:text="수정" onclick="showFormModifyBox(event, this)">
                                                <button type="button" class="answermodify_btn">수정</button>
                                                '
                                            </a>
                                            <a href="javascript:void(0);" th:data-uri="@{|/answer/delete/${answer.id}|}"
                                               class="delete btn btn-sm btn-outline-secondary"
                                               sec:authorize="isAuthenticated()"
                                               th:if="${answer.author != null and #authentication.getPrincipal().getUsername() == answer.author.username}"
                                               th:text="삭제">
                                                <button type="button" class="answerremove_btn">삭제</button>
                                            </a>
                                            <!--  수정/삭제버튼 끝 -->
                                        </div>

                                    </div>

                                    <!-- 댓글 하단바 끝   -->
                                </div>

                                <div class="formbox">
                                    <form th:action="@{|/answer/create/${article.id}|}" th:object="${answerForm}"
                                          method="post" class="formboxform">

                                        <textarea name="content" id="content" rows="10"
                                                  placeholder="내용을 입력해 주세요"></textarea>
                                        <input class="reply_summit" type="submit" value="답변등록">

                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 원래글쓰기버튼자리 -->


        <!-- 리뷰 박스 끝 -->

        <!--footer-->

    </div>
    <footer>
        <div class="footer-content">
            <p>&copy; 2023 Your Website. All rights reserved.</p>
            <nav>
                <a href="http://localhost:8080/mypage">Home</a>
                <a href="#">About</a>
                <a href="#">Contact</a>
            </nav>
        </div>
    </footer>
</div>
<script type='text/javascript'>
const delete_elements = document.getElementsByClassName("delete");
Array.from(delete_elements).forEach(function(element) {
    element.addEventListener('click', function() {
        if(confirm("정말로 삭제하시겠습니까?")) {
            location.href = this.dataset.uri;
        };
    });
});







</script>

<!--수정 댓글-->


<script>
  function showFormModifyBox(event, button) {
    event.preventDefault(); // 페이지 새로고침 방지

    var formModifyBox = $(button).closest('.answerbox').find('.formmodifybox');
    $(formModifyBox).css('display', 'block');

    var answerCreateBox = $(button).closest('.answerbox').find('.answerCreateBox');
    $(answerCreateBox).css('display', 'none');
  }
  function hideFormModifyBox(event, button) {
  event.preventDefault(); // 이벤트의 기본 동작 방지

  var formModifyBox = $(button).closest('.answerbox').find('.formmodifybox');
  $(formModifyBox).css('display', 'none');

  var answerCreateBox = $(button).closest('.answerbox').find('.answerCreateBox');
  $(answerCreateBox).css('display', 'block');
}






</script>
</body>
</html>