<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <script src="https://code.jquery.com/jquery-3.7.0.slim.min.js"
            integrity="sha256-tG5mcZUtJsZvyKAxYLVXrmjKBVLd6VpVccqz/r4ypFE=" crossorigin="anonymous"></script>
    <title>Document</title>
</head>
<body>
<form id="emailForm">
    <tr class="email">
        <th>
            <label for="useremail">이메일</label>
        </th>
        <td>
            <p>
                <input id="sm_email" type="text" name="sm_email" title="이메일 주소를 입력해주세요." required/>
                <span id="emailChk" class="doubleChk">인증번호 보내기</span><br/>
                <input id="sm_email2" type="text" name="sm_email2" title="인증번호 입력" disabled required/>
                <span id="emailChk2" class="doubleChk">이메일인증</span>
                <span class="point successEmailChk">이메일 입력 후 인증번호 보내기를 해주십시오.</span>
                <input type="hidden" id="emailDoubleChk"/>
            </p>
            <p class="tip">
                아이디 비밀번호 분실시 필요한 정보이므로, 정확하게 기입해 주십시오.
            </p>
        </td>
    </tr>
</form>
<script>
    var code = "";
    $("#emailChk").click(function () {
        var sm_email = $("#sm_email").val();
        $.ajax({
            type: "GET",
            url: "/mailCheck?sm_email=" + sm_email,
            cache: false,
            success: function (data) {
                if (data == "error") {
                    alert("이메일 주소가 올바르지 않습니다. 유효한 이메일 주소를 입력해주세요.");
                    $("#sm_email").attr("autofocus", true);
                    $(".successEmailChk").text("유효한 이메일 주소를 입력해주세요.");
                    $(".successEmailChk").css("color", "red");
                } else {
                    alert("인증번호 발송이 완료되었습니다.\n입력한 이메일에서 인증번호 확인을 해주십시오.");
                    $("#sm_email2").attr("disabled", false);
                    $("#emailChk2").css("display", "inline-block");
                    $(".successEmailChk").text("인증번호를 입력한 뒤 이메일 인증을 눌러주십시오.");
                    $(".successEmailChk").css("color", "green");
                    code = data;
                }
            }
        });
    });

    $("#emailChk2").click(function () {
        if ($("#sm_email2").val() == code) {
            $(".successEmailChk").text("인증번호가 일치합니다.");
            $(".successEmailChk").css("color", "green");
            $("#emailDoubleChk").val("true");
            $("#sm_email2").attr("disabled", true);
            //$("#sm_email").attr("disabled",true);
        } else {
            $(".successEmailChk").text("인증번호가 일치하지 않습니다. 확인해주시기 바랍니다.");
            $(".successEmailChk").css("color", "red");
            $("#emailDoubleChk").val("false");
            $("#sm_email2").attr("autofocus", true);
        }
    });

</script>
</body>
</html>