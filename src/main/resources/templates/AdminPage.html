<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="_csrf" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>
    <link rel="stylesheet" href="/AdminPage.css"/>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
      $(document).ready(function () {
        $(".menu-link").click(function (e) {
          e.preventDefault();

          var sectionId = $(this).data("section");
          $(".content-section").hide(); // 모든 섹션을 숨김
          $("#" + sectionId).show(); // 해당 섹션만 보이도록 함
        });
      });


















































    </script>
    <script>
      $(document).ready(function () {
        // 삭제 버튼 클릭 시
        $("button:contains('삭제')").click(function () {
          // 선택된 모든 체크박스 가져오기
          var checkboxes = $("input[name='delete-checkbox']:checked");

          // 각 선택된 체크박스에 대해 반복
          checkboxes.each(function () {
            // 체크박스를 포함하는 테이블 행(tr) 가져오기
            var row = $(this).closest("tr");

            // 글번호, 제목, 글쓴이, 날짜, 조회수 내용을 모두 지우기
            row.find(".number").empty();
            row.find(".title").empty();
            row.find(".date").empty();
            row.find(".inquiry").empty();
            row.find(".nickname").empty();
            row.find(".id").empty();
            row.find(".email").empty();

            // 수정 버튼 숨기기
            row.find(".modify button").hide();
          });
        });
      });


















































    </script>
    <script>
     $(document).ready(function () {
  // 회원 관리에서 체크박스 변경 이벤트 감지
  $("#member-section").on(
    "change",
    'input[name="administrator-checkbox"]',
    function () {
      if ($(this).is(":checked")) {
        // 체크박스가 선택되었을 때
        var row = $(this).closest("tr"); // 선택된 행 찾기
        var rowData = row.html(); // 선택된 행의 HTML 내용 가져오기
        row.remove(); // 선택된 행 삭제

        // 관리자 관리에 행 추가
        $("#admin-section table tbody").append("<tr>" + rowData + "</tr>");
      }
    }
  );
});
$(document).ready(function () {
  // 관리자 관리에서 체크박스 변경 이벤트 감지
  $("#admin-section").on(
    "change",
    'input[name="administrator-checkbox"]',
    function () {
      if ($(this).is(":checked")) {
        // 체크박스가 선택되었을 때
        var row = $(this).closest("tr"); // 선택된 행 찾기
        var rowData = row.html(); // 선택된 행의 HTML 내용 가져오기
        row.remove(); // 선택된 행 삭제

        // 회원 관리에 행 추가
        $("#member-section table tbody").append("<tr>" + rowData + "</tr>");
      }
    }
  );
});


















































    </script>
    <title>AdminPage</title>
</head>
<body>
<header>
    <div>
        <h1>관리자 페이지</h1>
    </div>
    <div class="button">
        <button type="button">
            <a href="#">로그아웃</a>
        </button>
    </div>
</header>
<div class="content">
    <nav class="admin_menu">
        <ul>
            <li>
                <a href="#" class="menu-link" data-section="notice-section">공시사항 관리</a>
            </li>
            <li>
                <a href="#" class="menu-link" data-section="review-section">리뷰 글 관리</a>
            </li>
            <li>
                <a href="#" class="menu-link" data-section="market-section">마켓 글 관리</a>
            </li>
            <li>
                <a href="#" class="menu-link" data-section="member-section">회원 관리</a>
            </li>
            <li>
                <a href="#" class="menu-link" data-section="admin-section">관리자 관리</a>
            </li>
        </ul>
    </nav>
    <section id="notice-section" class="content-section">
        <div class="top-bar">
            <h2>공지사항 관리</h2>
            <div class="button">
                <button type="button"><a th:href="@{/notice/create}">글쓰기</a></button>
                <button type="button">삭제</button>
            </div>
        </div>
        <table>
            <thead>
            <tr>
                <th class="check_box"></th>
                <th class="number">글번호</th>
                <th class="title">제목</th>
                <th class="date">작성일</th>
                <th class="inquiry">조회</th>
                <th class="modify">수정일</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="notice : ${noticeList}">
                <td class="checkbox">
                    <input type="checkbox" name="delete-checkbox" value="1"/>
                </td>
                <td class="number" th:text="${notice.id}"></td>
                <td class="title"><a th:href="@{|/notice/detail/${notice.id}|}" th:text="${notice.subject}"></a></td>
                <td class="date" th:text="${notice.createDate}"></td>
                <td class="inquiry" th:text="${notice.viewCount}"></td>
                <td class="modify" th:text="${notice.modifyDate}">
                    <button type="button"></button>
                </td>
            </tr>
        </table>
    </section>
    <section id="review-section" class="content-section">
        <div class="top-bar">
            <h2>리뷰 글 관리</h2>
            <button type="button">삭제</button>
        </div>
        <table>
            <thead>
            <tr>
                <th class="check_box"></th>
                <th class="number">글번호</th>
                <th class="title">제목</th>
                <th class="nickname">닉네임</th>
                <th class="date">날짜</th>
                <th class="inquiry">조회</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="article : ${articleList}">
                <td class="checkbox">
                    <input type="checkbox" name="delete-checkbox" value="1"/>
                </td>
                <td class="number" th:text="${article.id}"></td>
                <td class="title"><a th:href="@{|/article/detail/${article.id}|}" th:text="${article.subject}"></a></td>
                <td class="nickname" th:text="${article.author}"></td>
                <td class="date" th:text="${article.createDate}"></td>
                <td class="inquiry" th:text="${article.viewCount}"></td>
            </tr>
            </tbody>
        </table>
    </section>
    <section id="market-section" class="content-section">
        <div class="top-bar">
            <h2>마켓 글 관리</h2>
            <div class="button">
                <button type="button">삭제</button>
            </div>
        </div>
        <table>
            <thead>
            <tr>
                <th class="check_box"></th>
                <th class="number">글번호</th>
                <th class="title">제목</th>
                <th class="nickname">닉네임</th>
                <th class="date">날짜</th>
                <th class="inquiry">조회</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="market : ${marketList}">
                <td class="checkbox">
                    <input type="checkbox" name="delete-checkbox" value="1"/>
                </td>
                <td class="number" th:text="${market.id}"></td>
                <td class="title"><a th:href="@{|/market/detail/${market.id}|}" th:text="${market.subject}"></a></td>
                <td class="nickname" th:text="${market.author}"></td>
                <td class="date" th:text="${market.createDate}"></td>
                <td class="inquiry" th:text="${market.viewCount}"></td>
            </tr>
            </tbody>
        </table>
    </section>
    <section id="member-section" class="content-section">
        <div class="top-bar">
            <h2>회원 관리</h2>
            <button type="button">회원삭제</button>
        </div>
        <table>
            <thead>
            <tr>
                <th class="check_box"></th>
                <th class="number">번호</th>
                <th class="id">아이디</th>
                <th class="nickname">닉네임</th>
                <th class="email">이메일</th>
                <th class="administrator">관리자권한부여</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="user : ${userList}">
                <td class="checkbox">
                    <input type="checkbox" name="delete-checkbox" value="1"/>
                </td>
                <td class="number" th:text="${user.id}"></td>
                <td class="id" th:text="${user.username}"></td>
                <td class="nickname" th:text="${user.nickname}"></td>
                <td class="email" th:text="${user.email}"></td>
                <td class="checkbox administrator">
                    <input type="checkbox" name="addadmin-checkbox" value="1"
                           th:onclick="addAdminRole([[${user.id}]])"
                    />
                </td>
            </tr>
            </tbody>
        </table>
    </section>
    <section id="admin-section" class="content-section">
        <div class="top-bar">
            <h2>관리자 관리</h2>
        </div>
        <table>
            <thead>
            <tr>
                <th class="check_box"></th>
                <th class="number">번호</th>
                <th class="id">아이디</th>
                <th class="nickname">닉네임</th>
                <th class="email">이메일</th>
                <th class="administrator">관리자권한회수</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="user : ${userList}" th:if="${user.userRole == T(com.ll.sbb.User.UserRole).ADMIN}">
                <td class="check_box"></td>
                <td class="number" th:text="${user.id}"></td>
                <td class="id" th:text="${user.username}"></td>
                <td class="nickname" th:text="${user.nickname}"></td>
                <td class="email" th:text="${user.email}"></td>
                <td class="administrator">
                    <input type="checkbox" name="minusadmin-checkbox" value="1"
                           th:onclick="minusAdminRole([[${user.id}]])"
                    />
                </td>
            </tr>
            </tbody>
        </table>
    </section>
</div>
<footer>
    <div class="footer-content">
        <p>© 2023 관리자 페이지. All rights reserved.</p>
    </div>
</footer>
</body>
<script>
    var header = $("meta[name='_csrf_header']").attr('content');
    var token = $("meta[name='_csrf']").attr('content');

    function addAdminRole(userId) {
        $.ajax({
            type: 'POST',
            url: '/admin/addAdminRole',
            data: { id: userId },
            beforeSend: function(xhr){
                xhr.setRequestHeader(header, token);
            },
            success: function(response) {
                alert(response);
                // 관리자 권한이 부여된 경우에 필요한 처리를 수행합니다.
            },
            error: function(xhr, status, error) {
                alert('오류가 발생했습니다: ' + error);
            }
        });
    }

    function minusAdminRole(userId) {
        $.ajax({
            type: 'POST',
            url: '/admin/minusAdminRole',
            data: { id: userId },
            success: function(response) {
                alert(response);
                // 관리자 권한이 회수된 경우에 필요한 처리를 수행합니다.
            },
            error: function(xhr, status, error) {
                alert('오류가 발생했습니다: ' + error);
            }
        });
    }


</script>

</html>
